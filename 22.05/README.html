
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cuNumeric &#8212; cunumeric  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/params.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/copybutton_pydocs.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api/index.html" />
    <link rel="prev" title="Welcome to cuNumeric’s documentation!" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">cunumeric</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Overview
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="comparison/comparison.html">
  API coverage
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="CONTRIBUTING.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="versions.html">
  Versions
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependencies">
   Dependencies
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-from-source">
   Building from Source
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#usage-and-execution">
   Usage and Execution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supported-and-planned-features">
   Supported and Planned Features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supported-types-and-dimensions">
   Supported Types and Dimensions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#documentation">
   Documentation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#future-directions">
   Future Directions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contributing">
   Contributing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#known-issues">
   Known Issues
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <!--
Copyright 2021-2022 NVIDIA Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

--><div class="section" id="cunumeric">
<h1>cuNumeric<a class="headerlink" href="#cunumeric" title="Permalink to this headline">#</a></h1>
<p>cuNumeric is a <a class="reference external" href="https://github.com/nv-legate/legate.core">Legate</a> library
that aims to provide a distributed and accelerated drop-in replacement for the
<a class="reference external" href="https://numpy.org/doc/stable/reference/">NumPy API</a> on top of the
<a class="reference external" href="https://legion.stanford.edu">Legion</a> runtime. Using cuNumeric you do things like run
<a class="reference external" href="https://github.com/barbagroup/CFDPython/blob/master/lessons/15_Step_12.ipynb">the final example of the Python CFD course</a>
completely unmodified on 2048 A100 GPUs in a <a class="reference external" href="https://github.com/barbagroup/CFDPython/blob/master/lessons/15_Step_12.ipynb">DGX SuperPOD</a> and achieve good weak scaling.</p>
<img src="docs/figures/cfd-demo.png" alt="drawing" width="500"/><p>cuNumeric works best for programs that have very large arrays of data
that cannot fit in the memory of a single GPU or a single node and need
to span multiple nodes and GPUs. While our implementation of the current
NumPy API is still incomplete, programs that use unimplemented features
will still work (assuming enough memory) by falling back to the
canonical NumPy implementation.</p>
<p>If you have questions, please contact us at legate(at)nvidia.com.</p>
<ol class="simple">
<li><p><a class="reference external" href="#installation">Installation</a></p></li>
<li><p><a class="reference external" href="#dependencies">Dependencies</a></p></li>
<li><p><a class="reference external" href="#building-from-source">Building from Source</a></p></li>
<li><p><a class="reference external" href="#usage-and-execution">Usage and Execution</a></p></li>
<li><p><a class="reference external" href="#supported-and-planned-features">Supported and Planned Features</a></p></li>
<li><p><a class="reference external" href="#supported-types-and-dimensions">Supported Types and Dimensions</a></p></li>
<li><p><a class="reference external" href="#documentation">Documentation</a></p></li>
<li><p><a class="reference external" href="#future-directions">Future Directions</a></p></li>
<li><p><a class="reference external" href="#contributing">Contributing</a></p></li>
<li><p><a class="reference external" href="#known-bugs">Known Bugs</a></p></li>
</ol>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<p>cuNumeric is available <a class="reference external" href="https://anaconda.org/legate/cunumeric">on conda</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">nvidia</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="o">-</span><span class="n">c</span> <span class="n">legate</span> <span class="n">cunumeric</span>
</pre></div>
</div>
<p>Docker image build scripts, as well as specialized install scripts for
supported clusters are available on the
<a class="reference external" href="https://github.com/nv-legate/quickstart">quickstart</a> repo.</p>
<p>Read on for general instructions on building cuNumeric from source.</p>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">#</a></h2>
<p>Users must have a working installation of the
<a class="reference external" href="https://github.com/nv-legate/legate.core">Legate Core</a>
library prior to installing cuNumeric.</p>
<p>cuNumeric requires the following:</p>
<ul class="simple">
<li><p>Python &gt;= 3.7</p></li>
<li><p><a class="reference external" href="https://developer.nvidia.com/cuda-downloads">CUDA</a> &gt;= 8.0</p></li>
<li><p>GNU Make</p></li>
<li><p>C++14 compatible compiler (g++, clang, or nvc++)</p></li>
<li><p>Fortran compiler (for building OpenBLAS; not necessary if you provide a pre-built version of OpenBLAS)</p></li>
<li><p>the Python packages listed in <code class="docutils literal notranslate"><span class="pre">conda/cunumeric_dev.yml</span></code></p></li>
</ul>
<p>See the <a class="reference external" href="https://github.com/nv-legate/legate.core#dependencies">corresponding section</a>
on the Legate Core instructions for help on installing the required Python packages
using conda.</p>
</div>
<div class="section" id="building-from-source">
<h2>Building from Source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">#</a></h2>
<p>Installation of cuNumeric is done with either <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> for simple
uses cases or <code class="docutils literal notranslate"><span class="pre">install.py</span></code> for more advanced use cases. The most common
installation command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">core</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">legate</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">installation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This will build cuNumeric against the Legate Core installation and then
install cuNumeric into the same location.</p>
<p>Note that after the first invocation of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> this repository will remember
which Legate Core installation to use and the <code class="docutils literal notranslate"><span class="pre">--with-core</span></code> option can be
omitted unless the user wants to change it.</p>
<p>Advanced users can also invoke <code class="docutils literal notranslate"><span class="pre">install.py</span> <span class="pre">--help</span></code> to see options for
configuring cuNumeric by invoking the <code class="docutils literal notranslate"><span class="pre">install.py</span></code> script directly.</p>
<p>Of particular interest to cuNumeric users will likely be the option for
specifying an installation of <a class="reference external" href="https://www.openblas.net/">OpenBLAS</a> to use.
If you already have an installation of OpenBLAS on your machine you can
inform the <code class="docutils literal notranslate"><span class="pre">install.py</span></code> script about its location using the <code class="docutils literal notranslate"><span class="pre">--with-openblas</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">openblas</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">open</span><span class="o">/</span><span class="n">blas</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="usage-and-execution">
<h2>Usage and Execution<a class="headerlink" href="#usage-and-execution" title="Permalink to this headline">#</a></h2>
<p>Using cuNumeric as a replacement for NumPy is easy. Users only need
to replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cunumeric</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>These programs can then be run by the Legate driver script described in the
<a class="reference external" href="https://github.com/nv-legate/legate.core">Legate Core</a> documentation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">legate</span> <span class="n">cunumeric_program</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>For execution with multiple nodes (assuming Legate Core is installed with GASNet support)
users can supply the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> flag. For execution with GPUs, users can use the
<code class="docutils literal notranslate"><span class="pre">--gpus</span></code> flags to specify the number of GPUs to use per node. We encourage all users
to familiarize themselves with these resource flags as described in the Legate Core
documentation or simply by passing <code class="docutils literal notranslate"><span class="pre">--help</span></code> to the <code class="docutils literal notranslate"><span class="pre">legate</span></code> driver script.</p>
</div>
<div class="section" id="supported-and-planned-features">
<h2>Supported and Planned Features<a class="headerlink" href="#supported-and-planned-features" title="Permalink to this headline">#</a></h2>
<p>cuNumeric is currently a work in progress and we are gradually adding support for
additional NumPy operators. Unsupported NumPy operations will provide a
warning that we are falling back to canonical NumPy. Please report unimplemented
features that are necessary for attaining good performance so that we can triage
them and prioritize implementation appropriately. The more users that report an
unimplemented feature, the more we will prioritize it. Please include a pointer
to your code if possible too so we can see how you are using the feature in context.</p>
</div>
<div class="section" id="supported-types-and-dimensions">
<h2>Supported Types and Dimensions<a class="headerlink" href="#supported-types-and-dimensions" title="Permalink to this headline">#</a></h2>
<p>cuNumeric currently supports the following NumPy types: <code class="docutils literal notranslate"><span class="pre">float16</span></code>, <code class="docutils literal notranslate"><span class="pre">float32</span></code>,
<code class="docutils literal notranslate"><span class="pre">float64</span></code>, <code class="docutils literal notranslate"><span class="pre">int16</span></code>, <code class="docutils literal notranslate"><span class="pre">int32</span></code>, <code class="docutils literal notranslate"><span class="pre">int64</span></code>, <code class="docutils literal notranslate"><span class="pre">uint16</span></code>, <code class="docutils literal notranslate"><span class="pre">uint32</span></code>, <code class="docutils literal notranslate"><span class="pre">uint64</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>,
<code class="docutils literal notranslate"><span class="pre">complex64</span></code>, and <code class="docutils literal notranslate"><span class="pre">complex128</span></code>.</p>
<p>cuNumeric supports up to 4D arrays by default, you can adjust this setting by
installing legate.core with a larger <code class="docutils literal notranslate"><span class="pre">--max-dim</span></code>.</p>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">#</a></h2>
<p>A complete list of available features can is provided in the <a class="reference external" href="https://nv-legate.github.io/cunumeric/api/index.html">API
reference</a>.</p>
</div>
<div class="section" id="future-directions">
<h2>Future Directions<a class="headerlink" href="#future-directions" title="Permalink to this headline">#</a></h2>
<p>There are three primary directions that we plan to investigate
with cuNumeric going forward:</p>
<ul class="simple">
<li><p>More features: we plan to identify a few key lighthouse applications
and use the demands of these applications to drive the addition of
new features to cuNumeric.</p></li>
<li><p>We plan to add support for sharded file I/O for loading and
storing large data sets that could never be loaded on a single node.
Initially this will begin with native support for <a class="reference external" href="https://www.h5py.org/">h5py</a>
but will grow to accommodate other formats needed by our lighthouse
applications.</p></li>
<li><p>Strong scaling: while cuNumeric is currently implemented in a way that
enables weak scaling of codes on larger data sets, we would also like
to make it possible to strong-scale Legate applications for a single
problem size. This will require leveraging some of the more advanced
features of Legion from inside the Python interpreter.</p></li>
</ul>
<p>We are open to comments, suggestions, and ideas.</p>
</div>
<div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">#</a></h2>
<p>See the discussion of contributing in <a class="reference internal" href="CONTRIBUTING.html"><span class="doc">CONTRIBUTING.md</span></a>.</p>
</div>
<div class="section" id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>When using certain operations with high scratch space requirements (e.g.
<code class="docutils literal notranslate"><span class="pre">einsum</span></code> or <code class="docutils literal notranslate"><span class="pre">convolve</span></code>) you might run into the following error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LEGION</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">allocate</span> <span class="n">DeferredBuffer</span><span class="o">/</span><span class="n">Value</span><span class="o">/</span><span class="n">Reduction</span> <span class="ow">in</span> <span class="n">task</span> <span class="p">[</span><span class="n">some</span> <span class="n">task</span><span class="p">]</span> <span class="n">because</span> <span class="p">[</span><span class="n">some</span> <span class="n">memory</span><span class="p">]</span> <span class="ow">is</span> <span class="n">full</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">eager</span> <span class="n">allocation</span> <span class="o">...</span>
</pre></div>
</div>
<p>Currently, Legion splits its memory reservations between two pools: the
“deferred” pool, used for allocating cuNumeric <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>s, and the “eager”
pool, used for allocating scratch memory for operations. The above error
message signifies that not enough memory was available for an operation’s
scratch space requirements. You can work around this by allocating more
memory overall to cuNumeric (e.g. adjusting <code class="docutils literal notranslate"><span class="pre">--sysmem</span></code>, <code class="docutils literal notranslate"><span class="pre">--numamem</span></code> or
<code class="docutils literal notranslate"><span class="pre">--fbmem</span></code>), and/or by adjusting the split between the two pools (e.g. by
passing <code class="docutils literal notranslate"><span class="pre">-lg:eager_alloc_percentage</span> <span class="pre">60</span></code> on the command line to allocate 60%
of memory to the eager pool, up from the default of 50%).</p>
</li>
<li><p>cuNumeric can exercise a bug in OpenBLAS when it is run with
<a class="reference external" href="https://github.com/xianyi/OpenBLAS/issues/2146">multiple OpenMP processors</a></p></li>
<li><p>On Mac OSX, cuNumeric can trigger a bug in Apple’s implementation of libc++.
The <a class="reference external" href="https://bugs.llvm.org/show_bug.cgi?id=43764">bug</a> has since been fixed but
likely will not show up on most Apple machines for quite some time. You may have
to manually patch your implementation of libc++. If you have trouble doing this
please contact us and we will be able to help you.</p></li>
</ul>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to cuNumeric’s documentation!</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="api/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021-2022, NVIDIA.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>